<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/static/css/chouti01.css" />
</head>
<body>
    <div id="shade" class="shade hide">

    </div>

    <div id="kong" class="kong hide">
        <div class="register-login-header">
            <div class="div-login">
               <span class="span-login">登录</span>
            </div>
            <div class="div-register">
                <span class="span-register">注册</span>
                <span class="login-register-cancle" onclick="canClick()"></span>
            </div>

        </div>
        <div class="register-login-body">
            <div class="left-login">
                <div class="left-login-header">
                    <ul>
                        <li class="phone-login-li">
                            <span class="phone-login" onclick="phoneLogin();">
                                手机号登录
                            </span>
                        </li>
                        <li class="border-login-li">
                            <span class="border-login-li-span" style="border-left: 1px solid lightblue;margin-left: 20px;">

                            </span>
                        </li>
                        <li class="user-login-li">
                            <span class="user-login" onclick="userLogin();">
                                用户名登录
                            </span>
                        </li>
                    </ul>
                </div>

                <div class="left-login-body-phone">
                    <div class="left-login-body-phone-mid">
                        <div class="err-msg"></div>
                        <div>
                            <select class="region input-union">
                                <option value="86">中国(+86)</option>
                                <option value="852">中国香港(+852)</option>
                                <option value="853">中国澳门(+853)</option>
                                <option value="886">中国台湾(+886)</option>
                                <option value="1">美国(+1)</option>
                                <option value="1">加拿大(+1)</option>
                                <option value="60">马来西亚(+60)</option>
                                <option value="61">澳洲(+61)</option>
                                <option value="81">日本(+81)</option>
                                <option value="82">韩国(+82)</option>
                                <option value="65">新加坡(+65)</option>
                                <option value="44">英国(+44)</option>
                                <option value="33">法国(+33)</option>
                                <option value="7">俄罗斯(+7)</option>
                                <option value="91">印度(+91)</option>
                                <option value="66">泰国(+66)</option>
                                <option value="49">德国(+49)</option>
                            </select>
                            </div>
                            <form class="form-mobilelogin-login" action="#" autocomplete="on">
                                <div class="input-union-phone1">
                                    <input type="text" name="mobile" id="mobile" placeholder="手机号" class="mobile f1" tabindex="1" require="true" label="手机号" phone="true"/>
{#                                    <span class="input-warning ">手机号不能为空</span>#}
                                </div>
                                <div class="input-union-pwd1"><input type="password" name="loginpwd" id="mbpwd" placeholder="密码" class="mbpwd f1" tabindex="2" require="true" label="密码" minLen="6"/></div>
                            </form>
                    </div>

                    <div class="box-idlogin hide" >
                        <div class="err-msg"></div>
                            <form class="form-idlogin" action="#" autocomplete="on">
                                <div class="pr">
                                    <input type="text" name="userid" id="userid" placeholder="用户名" class="userid f1" tabindex="1" require="true" minLen="8" label="用户名"/>
                                </div>
                                <div class="pr">
                                    <input type="password" name="loginpwd" id="userpwd" placeholder="密码" class="pwd f1" tabindex="2" require="true" minLen="6" label="密码"/>
                                </div>
                            </form>
                    </div>

                    <div class="no-valid hide" style="height: 13px"></div>

                    <div class="left-login-body-phone-bottom">
                        <div style="position:relative;">
                            <span class="bottom-login-checkbox">
                                <input type="checkbox" class="keeplogin" value="1" checked />
                                <span class="autoLoginText">一个月内自动登录</span>
                            </span>
                            <span class="fgtpwd">
                                <a href="/profile/password/reset" class="forgetPwdA">
                                    忘记密码?
                                </a>
                            </span>
                        </div>
                        <div class="login-bottom" style="position: relative;" >
                            <span class="btn-login-span" onclick="OnSubmit();">登录</span>
                            <span style="display:none;"><img src="/static/images/loading.gif" >正在登录</span>
                        </div>
                    </div>


                </div>
            </div>

            <div class="left-login-border-right"></div>

            <div class="right-register">
                <div class="right-register-header">
                    <div class="right-register-header-text">
                        <span class="firstStep" style="color: #abb6d2;font-size: 14px;">
                            1 填写手机号
                        </span>
                        <span class="midStep" style="color: #abb6d2;font-size: 14px;">
                            &gt;
                        </span>
                        <span class="secondStep" style="color: #abb6d2;font-size: 14px;">
                            2 填写基本资料
                        </span>
                    </div>
                </div>

                <div class="right-register-body">
                    <div class="err-msg"></div>
                        <div>
                            <select class="region input-union">
                                <option value="86">中国(+86)</option>
                                <option value="852">中国香港(+852)</option>
                                <option value="853">中国澳门(+853)</option>
                                <option value="886">中国台湾(+886)</option>
                                <option value="1">美国(+1)</option>
                                <option value="1">加拿大(+1)</option>
                                <option value="60">马来西亚(+60)</option>
                                <option value="61">澳洲(+61)</option>
                                <option value="81">日本(+81)</option>
                                <option value="82">韩国(+82)</option>
                                <option value="65">新加坡(+65)</option>
                                <option value="44">英国(+44)</option>
                                <option value="33">法国(+33)</option>
                                <option value="7">俄罗斯(+7)</option>
                                <option value="91">印度(+91)</option>
                                <option value="66">泰国(+66)</option>
                                <option value="49">德国(+49)</option>
                            </select>
                            </div>
                            <form class="form-mobilelogin-register" action="#" autocomplete="on">
                                <div class="input-union-phone2">
                                    <input type="text" name="registermobile" id="registermobile" placeholder="手机号" class="register-mobile f3" tabindex="1"  require="true" label="手机号" phone="true"/>
                                </div>
                                <span class="mbck-span" nametag="register-exclude-span" onclick="getMbCode();">
                                    获取验证码
                                </span>
                                <span id="mbck" nametag="register-exclude-span" class="see-mbck hide">

                                </span>
                                <div class="input-union-checkcode2"><input type="text" name="mbcd" id="mbcd" placeholder="验证码" class="mbcd f3" tabindex="2" require="true" label="验证码" coderequire="true"/></div>
                                <div class="input-union-pwd2"><input type="password" name="registerpwd" id="registerpwd" placeholder="密码" class="mbpwd f3" tabindex="2"  require="true" minLen="6" label="密码"/></div>
                                <span class="next-step" nametag="register-exclude-span" onclick="OnRegister();">
                                    下一步
                                </span>

                            </form>
                </div>
            </div>
        </div>

    </div>


    <div class="page-header">
        <div class="header-inner">
            <div class="header-inner-left">
                <a class="header-image" href="/index/"></a>
                <ul>
                    <li>全部</li>
                    <li>42区</li>
                    <li>段子</li>
                    <li>图片</li>
                    <li>挨踢1024</li>
                    <li>你问我答</li>
                </ul>
            </div>

            <div class="header-inner-right">

                <input type="text" name="header-search" class="header-search"/>


                <ul>
                    <li class="login" onclick="Click();">登录</li>
                    <li class="register" onclick="Click();">注册</li>
                </ul>
                <a class="search-icon">
                    <span class="search-icon-span"></span>
                </a>
            </div>
        </div>
    </div>

    <div class="page-body">

    </div>

    <div class="page-footer">

    </div>
    <script src="/static/js/jquery-1.12.4.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <script type="text/javascript">
        code = "";


        function Click(){
            var t1 = document.getElementById('shade');
            var t2 = document.getElementById('kong');


            t1.classList.remove('hide');
            t2.classList.remove('hide');
        }

        function canClick(){
            var t1 = document.getElementById('shade');
            var t2 = document.getElementById('kong');


            t1.classList.add('hide');
            t2.classList.add('hide');
        }

        function phoneLogin(){
            $('.box-idlogin,.no-valid').addClass('hide');
            $('.left-login-body-phone-mid').removeClass('hide');
        }

        function userLogin(){
            $('.left-login-body-phone-mid').addClass('hide');
            $('.box-idlogin,.no-valid').removeClass('hide');
        }

        function getMbCode(){

            code = "";
            $('.see-mbck').removeClass('hide');
            var codeLength = 4;
{#            var checkCode = document.getElementById("mbck");#}
            var random = new Array(0,1,2,3,4,5,6,7,8,9,'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R',
            'S','T','U','V','W','X','Y','Z');
            for(var i = 0; i < codeLength; i++) {
                var index = Math.floor(Math.random()*36);
                code += random[index];
            }
            $('.see-mbck').text(code);
        }



        function OnRegister(){
            flag_ret = checkMethod('.form-mobilelogin-register',code);
            if(flag_ret){
                OnRegisterBack();
            }else{
                return false;
            }
        }
        function OnRegisterBack() {
            whatform1 = 'form-mobilelogin-register';
            $('form[class="' + whatform1 + '"] span').not("span[nametag='register-exclude-span']").remove();
            var info_dict = {};


            $('form[class="' + whatform1 + '"] input').not("input[name='mbcd']").each(function(){
                var v = $(this).val();
                var n = $(this).attr('name');
                info_dict[n] = v;

            })

            $.ajax({
                url : '/register/',
                type : 'POST',
                data : info_dict ,
                dataType : 'json',
                success:function(data){
                    if(data['status']) {
                        location.href = 'http://192.168.0.30:8000/index'
                    }
                    else{
                        $.each(data.message,function(k,v){
                            error_message = v[0].message;
                            var tag = document.createElement('span');
                            tag.className = 'input-warning';
                            tag.innerText = error_message;

                            $('form[class="' + whatform1 + '"] input[name="' + k + '"]').after(tag);

                        })}
                },
                error:function(data){

                }
        })
        }






        login_choice = "";
        function OnSubmit(){
            var flag_ret = "";
            hidestatus = $('.box-idlogin').hasClass('hide');
            if(hidestatus){
                login_choice = "phoneLogin"
                whatform = '.form-mobilelogin-login'
                whatform1 = 'form-mobilelogin-login'
            }else{
                login_choice = "userLogin"
                whatform = '.form-idlogin'
                whatform1 = 'form-idlogin'
            }

            flag_ret = checkMethod(whatform,code);
            if(flag_ret){
                OnSubmitBack();
            }else{
                return false;
            }
        }


        function OnSubmitBack(){

            $('form[class="' + whatform1 + '"] span').not("span[nametag='register-exclude-span']").remove();
            var info_dict = {};
            info_dict['login_choice'] = login_choice;

            $('form[class="' + whatform1 + '"] input').each(function(){
                var v = $(this).val();
                var n = $(this).attr('name');
                info_dict[n] = v;
                console.log(whatform1);
            })

            $.ajax({
                url : '/login/',
                type : 'POST',
                data : info_dict ,
                dataType : 'json',
                success:function(data){
                    if(data['status']) {
                        location.href = 'http://192.168.0.30:8000/index'
                    }
                    else{
                        $.each(data.message,function(k,v){
                            error_message = v[0].message;
                            var tag = document.createElement('span');
                            tag.className = 'input-warning';
                            tag.innerText = error_message;

                            $('form[class="' + whatform1 + '"] input[name="' + k + '"]').after(tag);

                        })}
                },
                error:function(data){

                }
        })
        }

        function checkMethod(formarg,code){
            function ErrorMessage(inp,message){
               var tag = document.createElement('span');
                tag.innerText = message;
                tag.className = 'input-warning';
                inp.after(tag);
            }



                var flag = true;
                $(formarg).find('span').not("span[nametag='register-exclude-span']").remove();
                $(formarg).find(':text,:password').each(function(){
                    var requireStatus = $(this).attr('require');
                    if(requireStatus){
                        var val = $(this).val();
                        if(val.length<=0){
                            var label = $(this).attr('label');
                            ErrorMessage($(this),label + '不能为空');
                            flag = false;
                            return false;
                        }


                        var minLen=$(this).attr('minLen');
                        var intMinLen = parseInt(minLen);
                        if(val.length<=intMinLen){
                            var label = $(this).attr('label');
                            ErrorMessage($(this),label + '不能小于' + minLen);
                            flag = false;
                            return false;
                        }

                        var coderequire = $(this).attr('coderequire');
                        var code_input = $('#mbcd').val();
                        if(coderequire){
                            if(code != code_input){
                                var label = $(this).attr('label');
                                ErrorMessage($(this),label + '错误');
                                flag = false;
                                return false;
                            }
                        }

                        var phoneStatus = $(this).attr('phone');
                        var phoneReg = /^1[3|5|7|8]\d{9}$/
                        if(phoneStatus){
                            if(!phoneReg.test(val)){
                                var label = $(this).attr('label');
                                ErrorMessage($(this),label + '格式错误');
                                flag = false;
                                return false;
                            }

                        }


                    }
                });

                return flag;

        }
    </script>
</body>
</html>